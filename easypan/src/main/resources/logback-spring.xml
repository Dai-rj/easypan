<?xml version="1.0" encoding="UTF-8" ?>
<!-- 配置文件版本及编码声明 -->
<configuration scan="true" scanPeriod="10 minutes">
    <!-- 定义控制台日志输出appender -->
    <appender name="stdout" class="ch.qos.logback.core.ConsoleAppender">
        <layout class="ch.qos.logback.classic.PatternLayout">
            <!-- 控制台日志输出格式，考虑安全性，避免过多敏感信息输出 -->
            <pattern>%d{yyyy-MM-dd HH:mm:ss,GMT+8} [%p][%c][%M][%L]-> %m%n</pattern>
        </layout>
    </appender>

    <!-- 从Spring属性配置中读取日志路径和日志级别 -->
    <springProperty scope="context" name="log.path" source="project.folder"/>
    <springProperty scope="context" name="log.root.level" source="log.root.level"/>

    <!-- 定义日志文件目录和文件名，考虑可维护性，可以为不同环境或需求配置不同的文件名 -->
    <property name="LOG_FOLDER" value="${log.path}"/>
    <property name="LOG_FILE_NAME" value="${easypan}.log"/> <!-- 使用变量或配置来动态设置日志文件名 -->

    <!-- 定义文件日志输出appender -->
    <appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_FOLDER}/${LOG_FILE_NAME}</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- 定义日志文件滚动策略，按日期和大小滚动 -->
            <FileNamePattern>${LOG_FOLDER}/${easypan}.log.%d{yyyyMMdd}.%i</FileNamePattern>
            <cleanHistoryOnStart>true</cleanHistoryOnStart>
            <TimeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <!-- 调整MaxFileSize以平衡日志滚动频率和文件大小 -->
                <MaxFileSize>50MB</MaxFileSize>
            </TimeBasedFileNamingAndTriggeringPolicy>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <!-- 日志文件编码和输出格式 -->
            <charset>utf-8</charset>
            <pattern>%d{yyyy-MM-dd HH:mm:ss,GMT+8} [%p][%c][%M][%L]-> %m%n</pattern>
        </encoder>
        <append>false</append>
        <prudent>false</prudent>
    </appender>

    <!-- 设置根日志级别和输出目标 -->
    <root level="${log.root.level}">
        <appender-ref ref="stdout"/>
        <appender-ref ref="file"/>
    </root>
</configuration>
